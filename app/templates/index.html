<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>WebGL Demo</title>
      <script type="text/javascript" src="{{url_for('static', filename='render.js')}}" defer></script>

    <script id="vertex-shader-2d" type="notjs">#version 300 es
      in vec4 a_position;
     
      void main() {
        gl_Position = a_position;
      }
     
    </script>
     
    <script id="fragment-shader-2d" type="notjs">#version 300 es
        precision highp float;

        out vec4 FragColor;

        vec3 color_palette(int i);

        float map(float v, float v1, float v2, float r1, float r2) {
            return r1 + (((v - v1) / (v2 - v1)) * (r2 - r1));  
        }

        vec3 hsv2rgb(vec3 c) {
            vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
            vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
            return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
        }
       
        void main() {
            float x = map(gl_FragCoord.x, 0.0, 1920.0, -2.55, 1.0);
            float y = map(gl_FragCoord.y, 0.0, 1080.0, -1.0, 1.0);
            float a = 0.0;
            float b = 0.0;
            float aa = 0.0;
            float bb = 0.0;

            int i = 0;
            int max_iterations = 1000;

            for(; aa + bb <= 4.0 && i < max_iterations; i++) {
                b = 2.0 * a * b + y;
                a = aa - bb + x;
                a = a / b;
                aa = a * a;
                bb = b * b;
            }

            if(i < max_iterations) {
                /*float f = sqrt(float(i) / float(max_iterations));
                FragColor = vec4(vec3(sqrt(f)), 1.0);*/
                vec3 color = color_palette(i);

                FragColor = vec4(color, 1.0);

            } else {
                FragColor = vec4(vec3(0.0), 1.0);
            }
        }

    vec3 color_palette(int i) {
        int n = i % 16;
        if (n == 0) {
            return vec3(66.0 / 255.0, 30.0 / 255.0, 15.0 / 255.0);
        } else if (n == 1) {
            return vec3(25.0 / 255.0, 7.0 / 255.0, 26.0 / 255.0);
        } else if (n == 2) {
            return vec3(9.0 / 255.0, 1.0 / 255.0, 47.0 / 255.0);
        } else if (n == 3) {
            return vec3(4.0 / 255.0, 4.0 / 255.0, 73.0 / 255.0);
        } else if (n == 4) {
            return vec3(0.0 / 255.0, 7.0 / 255.0, 100.0 / 255.0);
        } else if (n == 5) {
            return vec3(12.0 / 255.0, 44.0 / 255.0, 138.0 / 255.0);
        } else if (n == 6) {
            return vec3(24.0 / 255.0, 82.0 / 255.0, 177.0 / 255.0);
        } else if (n == 7) {
            return vec3(57.0 / 255.0, 125.0 / 255.0, 209.0 / 255.0);
        } else if (n == 8) {
            return vec3(134.0 / 255.0, 181.0 / 255.0, 229.0 / 255.0);
        } else if (n == 9) {
            return vec3(211.0 / 255.0, 236.0 / 255.0, 248.0 / 255.0);
        } else if (n == 10) {
            return vec3(241.0 / 255.0, 233.0 / 255.0, 191.0 / 255.0);
        } else if (n == 11) {
            return vec3(248.0 / 255.0, 201.0 / 255.0, 95.0 / 255.0);
        } else if (n == 12) {
            return vec3(255.0 / 255.0, 170.0 / 255.0, 0.0 / 255.0);
        } else if (n == 13) {
            return vec3(204.0 / 255.0, 128.0 / 255.0, 0.0 / 255.0);
        } else if (n == 14) {
            return vec3(153.0 / 255.0, 87.0 / 255.0, 0.0 / 255.0);
        } else {
            return vec3(106.0 / 255.0, 52.0 / 255.0, 3.0 / 255.0);
        }
    }
       
    </script>
  </head>

  <body>
      <button onclick="render_to('glcanvas')">Render</button>
      <button onclick="document.querySelector('#glcanvas').requestFullscreen()">Fullscreen</button>
    <canvas id="glcanvas" width="1920" height="1080"></canvas>
  </body>
</html>
